<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to phinterval • phinterval</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to phinterval">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">phinterval</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/phinterval.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/EthanSansom/phinterval/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction to phinterval</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/EthanSansom/phinterval/blob/main/vignettes/phinterval.Rmd" class="external-link"><code>vignettes/phinterval.Rmd</code></a></small>
      <div class="d-none name"><code>phinterval.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/EthanSansom/phinterval" class="external-link">phinterval</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span>, warn.conflicts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The phinterval package extends <a href="https://lubridate.tidyverse.org/" class="external-link">{lubridate}</a> to support
disjoint (“holey”) and empty time spans. It implements the
<code>&lt;phinterval&gt;</code> vector class, a generalization of the
standard contiguous <code>&lt;Interval&gt;</code>, which can
represent:</p>
<ul>
<li>
<strong>Contiguous spans:</strong> A contiguous interval bounded by
a start and end point (e.g., the year 2025).</li>
<li>
<strong>Empty spans:</strong> A set containing no time points (e.g.,
the intersection of your life and Napoleon’s).</li>
<li>
<strong>Disjoint spans:</strong> A set of multiple time spans
separated by gaps (e.g., the days you attended school, excluding
weekends and holidays).</li>
</ul>
<p>This package is designed to easily integrate into existing lubridate
workflows. Any <code>&lt;Interval&gt;</code> vector can be converted to
an equivalent <code>&lt;phinterval&gt;</code> vector using
<code><a href="../reference/as_phinterval.html">as_phinterval()</a></code>, and all phinterval functions accept either
<code>&lt;Interval&gt;</code> or <code>&lt;phinterval&gt;</code>
inputs.</p>
</div>
<div class="section level2">
<h2 id="when-time-isnt-continuous">When Time Isn’t Continuous<a class="anchor" aria-label="anchor" href="#when-time-isnt-continuous"></a>
</h2>
<p>Certain set operations on time spans naturally produce empty or
disjoint results, which are difficult to represent using a standard
interval. This section illustrates several such edge cases using the
months of January and November 2025, along with the full calendar
year.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jan</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/interval.html" class="external-link">interval</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2025-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2025-01-01"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html" class="external-link">months</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/interval.html" class="external-link">interval</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2025-11-01"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2025-11-01"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html" class="external-link">months</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">full_2025</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/interval.html" class="external-link">interval</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2025-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2025-01-01"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">years</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="empty-intersections">Empty Intersections<a class="anchor" aria-label="anchor" href="#empty-intersections"></a>
</h3>
<p>Because January and November do not overlap, their intersection
should contain no time.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">intersect</a></span><span class="op">(</span><span class="va">jan</span>, <span class="va">nov</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] NA--NA</span></span>
<span></span>
<span><span class="fu"><a href="../reference/phinterval-set-operations.html">phint_intersect</a></span><span class="op">(</span><span class="va">jan</span>, <span class="va">nov</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;phinterval&lt;UTC&gt;[1]&gt;</span></span>
<span><span class="co">#&gt; [1] &lt;hole&gt;</span></span></code></pre></div>
<p>In lubridate this is resolved by coercing the intersection to
<code>NA</code>, while phinterval returns a <code>&lt;hole&gt;</code>,
which explicitly represents an empty span of time.</p>
<p>This distinction matters when performing downstream calculations. For
example, counting the number of days contained in both January and
November:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">intersect</a></span><span class="op">(</span><span class="va">jan</span>, <span class="va">nov</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/duration.html" class="external-link">duration</a></span><span class="op">(</span>days <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] NA</span></span>
<span></span>
<span><span class="fu"><a href="../reference/phinterval-set-operations.html">phint_intersect</a></span><span class="op">(</span><span class="va">jan</span>, <span class="va">nov</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/duration.html" class="external-link">duration</a></span><span class="op">(</span>days <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="punching-holes-in-intervals">Punching Holes in Intervals<a class="anchor" aria-label="anchor" href="#punching-holes-in-intervals"></a>
</h3>
<p>Next, consider subtracting the month of November from the full year
of 2025.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">full_2025</span>, <span class="va">nov</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in setdiff.Interval(full_2025, nov) : </span></span>
<span><span class="co">#&gt;   Cases 1 result in discontinuous intervals.</span></span>
<span></span>
<span><span class="fu"><a href="../reference/phinterval-set-operations.html">phint_setdiff</a></span><span class="op">(</span><span class="va">full_2025</span>, <span class="va">nov</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;phinterval&lt;UTC&gt;[1]&gt;</span></span>
<span><span class="co">#&gt; [1] {2025-01-01--2025-11-01, 2025-12-01--2026-01-01}</span></span></code></pre></div>
<p>The result is two disjoint spans, January through October and
December, which can’t be represented by a single interval. As a result,
lubridate raises an error. In phinterval, the disjoint span is
represented as a single object with an explicit gap.</p>
</div>
<div class="section level3">
<h3 id="unions-of-non-overlapping-spans">Unions of Non-Overlapping Spans<a class="anchor" aria-label="anchor" href="#unions-of-non-overlapping-spans"></a>
</h3>
<p>Similarly, the union of January and November contains a gap from
February to October.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">union</a></span><span class="op">(</span><span class="va">jan</span>, <span class="va">nov</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2025-01-01 UTC--2025-12-01 UTC</span></span>
<span></span>
<span><span class="fu"><a href="../reference/phinterval-set-operations.html">phint_union</a></span><span class="op">(</span><span class="va">jan</span>, <span class="va">nov</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;phinterval&lt;UTC&gt;[1]&gt;</span></span>
<span><span class="co">#&gt; [1] {2025-01-01--2025-02-01, 2025-11-01--2025-12-01}</span></span></code></pre></div>
<p>In this case lubridate returns the span from the beginning of January
to the end of November, implicitly filling in the gap. The two disjoint
months are represented explicitly using phinterval.</p>
</div>
<div class="section level3">
<h3 id="subtracting-an-interval-from-itself">Subtracting an Interval from Itself<a class="anchor" aria-label="anchor" href="#subtracting-an-interval-from-itself"></a>
</h3>
<p>Finally, consider subtracting an interval from itself. Intuitively,
this should result in an empty time span.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">jan</span>, <span class="va">jan</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2025-01-01 UTC--2025-02-01 UTC</span></span>
<span></span>
<span><span class="fu"><a href="../reference/phinterval-set-operations.html">phint_setdiff</a></span><span class="op">(</span><span class="va">jan</span>, <span class="va">jan</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;phinterval&lt;UTC&gt;[1]&gt;</span></span>
<span><span class="co">#&gt; [1] &lt;hole&gt;</span></span></code></pre></div>
<p>In this case, lubridate returns the original interval, while
phinterval returns a <code>&lt;hole&gt;</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="case-study-employment-history">Case Study: Employment History<a class="anchor" aria-label="anchor" href="#case-study-employment-history"></a>
</h2>
<p>The phinterval package is most useful when working with tabular data
and vectorized workflows. To illustrate this, we’ll consider an abridged
employment history for several characters from the television show
<em>Succession</em>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jobs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">name</span>,   <span class="op">~</span><span class="va">job_title</span>,             <span class="op">~</span><span class="va">start</span>,        <span class="op">~</span><span class="va">end</span>,</span>
<span>  <span class="st">"Greg"</span>,  <span class="st">"Mascot"</span>,               <span class="st">"2018-01-01"</span>,  <span class="st">"2018-06-03"</span>,</span>
<span>  <span class="st">"Greg"</span>,  <span class="st">"Executive Assistant"</span>,  <span class="st">"2018-06-10"</span>,  <span class="st">"2020-04-01"</span>,</span>
<span>  <span class="st">"Greg"</span>,  <span class="st">"Chief of Staff"</span>,       <span class="st">"2020-03-01"</span>,  <span class="st">"2020-11-28"</span>,</span>
<span>  <span class="st">"Tom"</span>,   <span class="st">"Chairman"</span>,             <span class="st">"2019-05-01"</span>,  <span class="st">"2020-11-10"</span>,</span>
<span>  <span class="st">"Tom"</span>,   <span class="st">"CEO"</span>,                  <span class="st">"2020-11-10"</span>,  <span class="st">"2020-12-31"</span>,</span>
<span>  <span class="st">"Shiv"</span>,  <span class="st">"Political Consultant"</span>, <span class="st">"2017-01-01"</span>,  <span class="st">"2019-04-01"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Suppose we know that Greg, Tom, and Shiv went on a group Christmas
vacation in December 2017.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vacation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/interval.html" class="external-link">interval</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2017-12-23"</span><span class="op">)</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="st">"2017-12-29"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>If we want to analyze only the time spent working, and exclude time
on vacation, we might try to subtract the vacation interval from each
job span. However, this approach breaks down when the vacation falls
strictly within a job interval, as it does for Shiv’s Political
Consultant role.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span></span>
<span>  <span class="va">jobs</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      span <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/interval.html" class="external-link">interval</a></span><span class="op">(</span><span class="va">start</span>, <span class="va">end</span><span class="op">)</span>,</span>
<span>      span <span class="op">=</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">span</span>, <span class="va">vacation</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">job_title</span>, <span class="va">span</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in mutate(jobs, span = interval(start, end), span = setdiff(span,  : </span></span>
<span><span class="co">#&gt;   <span style="color: #00BBBB;">ℹ</span> In argument: `span = setdiff(span, vacation)`.</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Caused by error in `setdiff.Interval()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Cases 6 result in discontinuous intervals.</span></span></code></pre></div>
<p>Handling this correctly is surprisingly involved. One option is to
split Shiv’s job into two rows (one pre-vacation and one post-vacation),
breaking the one-row-per-job structure of the data. Another is to
represent each job as a list of intervals, complicating downstream
analysis. The main purpose of phinterval is to avoid these workarounds,
by providing drop-in replacements for lubridate interval functions.
Because phinterval functions accept either <code>&lt;Interval&gt;</code>
or <code>&lt;phinterval&gt;</code> inputs, existing code can typically
be adapted by simply replacing a lubridate function with its phinterval
counterpart.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jobs</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    span <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/interval.html" class="external-link">interval</a></span><span class="op">(</span><span class="va">start</span>, <span class="va">end</span><span class="op">)</span>,</span>
<span>    span <span class="op">=</span> <span class="fu"><a href="../reference/phinterval-set-operations.html">phint_setdiff</a></span><span class="op">(</span><span class="va">span</span>, <span class="va">vacation</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">job_title</span>, <span class="va">span</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   name  job_title                                                        span</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                    <span style="color: #949494; font-style: italic;">&lt;phint&lt;UTC&gt;&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Greg  Mascot                                       {2018-01-01--2018-06-03}</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Greg  Executive Assistant                          {2018-06-10--2020-04-01}</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Greg  Chief of Staff                               {2020-03-01--2020-11-28}</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Tom   Chairman                                     {2019-05-01--2020-11-10}</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Tom   CEO                                          {2020-11-10--2020-12-31}</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Shiv  Political Consultant {2017-01-01--2017-12-23, 2017-12-29--2019-04-01}</span></span></code></pre></div>
<div class="section level3">
<h3 id="merging-intervals">Merging Intervals<a class="anchor" aria-label="anchor" href="#merging-intervals"></a>
</h3>
<p>Suppose we want to analyze only the total time each character spent
employed, without distinguishing between individual jobs. This can be
done using <code><a href="../reference/phint_squash.html">phint_squash()</a></code>, which aggregates a vector of
intervals into a minimal set of non-overlapping spans within a scalar
<code>&lt;phinterval&gt;</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">employment</span> <span class="op">&lt;-</span> <span class="va">jobs</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>span <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/interval.html" class="external-link">interval</a></span><span class="op">(</span><span class="va">start</span>, <span class="va">end</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>employed <span class="op">=</span> <span class="fu"><a href="../reference/phint_squash.html">phint_squash</a></span><span class="op">(</span><span class="va">span</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">employment</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">#&gt;   name                                          employed</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                     <span style="color: #949494; font-style: italic;">&lt;phint&lt;UTC&gt;&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Greg  {2018-01-01--2018-06-03, 2018-06-10--2020-11-28}</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Shiv                          {2017-01-01--2019-04-01}</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Tom                           {2019-05-01--2020-12-31}</span></span></code></pre></div>
<p>Notice that:</p>
<ul>
<li>
<em>Greg</em> has multiple disjoint employment periods, which are
preserved as separate spans within a single
<code>&lt;phinterval&gt;</code> element.</li>
<li>
<em>Tom</em> held two back-to-back positions (Chairman followed by
CEO), which <code><a href="../reference/phint_squash.html">phint_squash()</a></code> correctly merges into a single
contiguous span.</li>
</ul>
<p>To return the dataset to a one-row-per-span format, we can extract
the start and end points of each <code>&lt;phinterval&gt;</code> element
using <code><a href="../reference/phinterval-accessors.html">phint_starts()</a></code> and <code><a href="../reference/phinterval-accessors.html">phint_ends()</a></code>. These
functions return lists of start and end dates, which can then be
unnested back into separate rows:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">employment</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    start <span class="op">=</span> <span class="fu"><a href="../reference/phinterval-accessors.html">phint_starts</a></span><span class="op">(</span><span class="va">employed</span><span class="op">)</span>, </span>
<span>    end <span class="op">=</span> <span class="fu"><a href="../reference/phinterval-accessors.html">phint_ends</a></span><span class="op">(</span><span class="va">employed</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">start</span>, <span class="va">end</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">employed</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 3</span></span></span>
<span><span class="co">#&gt;   name  start               end                </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Greg  2018-01-01 <span style="color: #949494;">00:00:00</span> 2018-06-03 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Greg  2018-06-10 <span style="color: #949494;">00:00:00</span> 2020-11-28 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Shiv  2017-01-01 <span style="color: #949494;">00:00:00</span> 2019-04-01 <span style="color: #949494;">00:00:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Tom   2019-05-01 <span style="color: #949494;">00:00:00</span> 2020-12-31 <span style="color: #949494;">00:00:00</span></span></span></code></pre></div>
<p>The resulting tidy format integrates well with <a href="https://dplyr.tidyverse.org/" class="external-link">{dplyr}</a> and lubridate
workflows.</p>
</div>
<div class="section level3">
<h3 id="finding-gaps">Finding Gaps<a class="anchor" aria-label="anchor" href="#finding-gaps"></a>
</h3>
<p>To analyze periods of unemployment, we need to identify the gaps
between employment intervals. The <code><a href="../reference/phint_invert.html">phint_invert()</a></code> function
returns the gaps between spans in a <code>&lt;phinterval&gt;</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">unemployment</span> <span class="op">&lt;-</span> <span class="va">employment</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    <span class="co"># Find the gaps between jobs</span></span>
<span>    unemployed <span class="op">=</span> <span class="fu"><a href="../reference/phint_invert.html">phint_invert</a></span><span class="op">(</span><span class="va">employed</span><span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># Calculate duration of unemployment</span></span>
<span>    days_unemployed <span class="op">=</span> <span class="va">unemployed</span> <span class="op">/</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/duration.html" class="external-link">ddays</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">unemployed</span>, <span class="va">days_unemployed</span><span class="op">)</span></span>
<span></span>
<span><span class="va">unemployment</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 3</span></span></span>
<span><span class="co">#&gt;   name                unemployed days_unemployed</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;phint&lt;UTC&gt;&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Greg  {2018-06-03--2018-06-10}               7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Shiv                    &lt;hole&gt;               0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Tom                     &lt;hole&gt;               0</span></span></code></pre></div>
<p>Greg was unemployed for 7 days between his time as a Mascot and his
role as Executive Assistant. Tom and Shiv have no gaps within their
respective employment timelines, represented by a
<code>&lt;hole&gt;</code>.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ethan Sansom.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
